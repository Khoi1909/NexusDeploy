<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusDeploy - Test GitHub Login</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border-color: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-green: #238636;
            --accent-green-hover: #2ea043;
            --accent-blue: #58a6ff;
            --accent-red: #f85149;
            --accent-orange: #d29922;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card h2::before {
            content: '';
            width: 4px;
            height: 1.2rem;
            background: var(--accent-blue);
            border-radius: 2px;
        }

        .config-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        input, textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.875rem;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-green-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn-danger:hover {
            background: #da3633;
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .github-icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .status {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.8rem;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: rgba(35, 134, 54, 0.15);
            border: 1px solid var(--accent-green);
            color: #3fb950;
        }

        .status.error {
            background: rgba(248, 81, 73, 0.15);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        .status.info {
            background: rgba(88, 166, 255, 0.15);
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .token-display {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            overflow-x: auto;
        }

        .token-display pre {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .token-item {
            margin-bottom: 0.75rem;
        }

        .token-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .token-value {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.8rem;
            color: var(--accent-orange);
            word-break: break-all;
        }

        .divider {
            height: 1px;
            background: var(--border-color);
            margin: 1.5rem 0;
        }

        .instructions {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .instructions h3 {
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--accent-blue);
        }

        .instructions ol {
            margin-left: 1.25rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .instructions li {
            margin-bottom: 0.25rem;
        }

        .instructions code {
            background: var(--bg-tertiary);
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        @media (max-width: 600px) {
            body {
                padding: 1rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ NexusDeploy</h1>
        <p class="subtitle">Test GitHub OAuth Login</p>

        <div class="instructions">
            <h3>üìã H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
            <ol>
                <li>ƒê·∫£m b·∫£o API Gateway ƒëang ch·∫°y t·∫°i ƒë·ªãa ch·ªâ b√™n d∆∞·ªõi</li>
                <li>ƒê·∫£m b·∫£o Auth Service ƒëang ch·∫°y v√† k·∫øt n·ªëi v·ªõi Gateway</li>
                <li>C·∫•u h√¨nh GitHub OAuth App v·ªõi Redirect URL: <code>{API_URL}/auth/github/callback</code></li>
                <li>Click "Login with GitHub" ƒë·ªÉ b·∫Øt ƒë·∫ßu</li>
            </ol>
        </div>

        <!-- Config Section -->
        <div class="card">
            <h2>‚öôÔ∏è C·∫•u h√¨nh</h2>
            <div class="config-group">
                <label for="apiUrl">API Gateway URL</label>
                <input type="text" id="apiUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
            </div>
        </div>

        <!-- Login Section -->
        <div class="card">
            <h2>üîê ƒêƒÉng nh·∫≠p GitHub</h2>
            <div class="btn-group">
                <a id="loginBtn" href="#" class="btn btn-primary" onclick="loginWithGitHub()">
                    <svg class="github-icon" viewBox="0 0 16 16">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    Login with GitHub
                </a>
            </div>
            <div id="loginStatus" class="status"></div>
        </div>

        <!-- Token Display Section -->
        <div class="card" id="tokenSection" style="display: none;">
            <h2>üé´ Tokens</h2>
            <div class="token-display">
                <div class="token-item">
                    <div class="token-label">Access Token</div>
                    <div class="token-value" id="accessTokenDisplay">-</div>
                </div>
                <div class="token-item">
                    <div class="token-label">Refresh Token</div>
                    <div class="token-value" id="refreshTokenDisplay">-</div>
                </div>
                <div class="token-item">
                    <div class="token-label">User ID</div>
                    <div class="token-value" id="userIdDisplay">-</div>
                </div>
                <div class="token-item">
                    <div class="token-label">Plan</div>
                    <div class="token-value" id="planDisplay">-</div>
                </div>
                <div class="token-item">
                    <div class="token-label">Expires At</div>
                    <div class="token-value" id="expiresDisplay">-</div>
                </div>
            </div>
            <div class="divider"></div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="copyTokens()">üìã Copy Tokens</button>
                <button class="btn btn-secondary" onclick="clearTokens()">üóëÔ∏è Clear</button>
            </div>
        </div>

        <!-- Test Refresh Token -->
        <div class="card">
            <h2>üîÑ Test Refresh Token</h2>
            <div class="config-group">
                <label for="refreshTokenInput">Refresh Token</label>
                <input type="text" id="refreshTokenInput" placeholder="Paste refresh token here...">
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="testRefresh()">Refresh Token</button>
            </div>
            <div id="refreshStatus" class="status"></div>
        </div>

        <!-- Test Logout -->
        <div class="card">
            <h2>üö™ Test Logout</h2>
            <div class="config-group">
                <label for="logoutTokenInput">Access Token</label>
                <input type="text" id="logoutTokenInput" placeholder="Paste access token here...">
            </div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="testLogout()">Logout (Revoke Token)</button>
            </div>
            <div id="logoutStatus" class="status"></div>
        </div>

        <!-- Project Service Test -->
        <div class="card">
            <h2>üìÅ Test Project Service</h2>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
                Token s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông l·∫•y t·ª´ Auth Service (frontend kh√¥ng th·∫•y GitHub token)
            </p>
            <div class="btn-group" style="flex-wrap: wrap; gap: 0.5rem;">
                <button class="btn btn-secondary" onclick="testListRepos()">üìÇ List GitHub Repos</button>
                <button class="btn btn-secondary" onclick="testListProjects()">üìã List Projects</button>
            </div>
            <div id="projectStatus" class="status"></div>
            
            <div class="divider" style="margin: 1.5rem 0; border-top: 1px solid var(--border-color);"></div>
            
            <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">‚ûï Create New Project</h3>
            <div class="config-group">
                <label for="projectName">Project Name</label>
                <input type="text" id="projectName" placeholder="my-awesome-app">
            </div>
            <div class="config-group">
                <label for="repoUrl">Repository URL</label>
                <input type="text" id="repoUrl" placeholder="https://github.com/username/repo">
            </div>
            <div class="config-group">
                <label for="preset">Preset</label>
                <select id="preset" style="width: 100%; padding: 0.75rem 1rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary);">
                    <option value="nodejs">Node.js</option>
                    <option value="go">Go</option>
                    <option value="python">Python</option>
                    <option value="static">Static</option>
                </select>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="testCreateProject()">Create Project</button>
            </div>
            <div id="createProjectStatus" class="status"></div>
        </div>

        <!-- API Response Log -->
        <div class="card">
            <h2>üìù Response Log</h2>
            <div class="token-display">
                <pre id="responseLog">Ch∆∞a c√≥ response n√†o...</pre>
            </div>
            <div class="btn-group" style="margin-top: 1rem;">
                <button class="btn btn-secondary" onclick="clearLog()">Clear Log</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentTokens = {
            accessToken: null,
            refreshToken: null,
            userId: null,
            plan: null,
            expiresAtUnix: null
        };

        // Get API URL
        function getApiUrl() {
            return document.getElementById('apiUrl').value.replace(/\/$/, '');
        }

        // Log response
        function logResponse(action, data, isError = false) {
            const log = document.getElementById('responseLog');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = isError ? '‚ùå' : '‚úÖ';
            const formatted = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
            log.textContent = `[${timestamp}] ${prefix} ${action}\n${formatted}\n\n` + log.textContent;
        }

        // Show status
        function showStatus(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = `status show ${type}`;
        }

        // Login with GitHub
        function loginWithGitHub() {
            const apiUrl = getApiUrl();
            const loginUrl = `${apiUrl}/auth/github/login`;
            
            showStatus('loginStatus', `Redirecting to ${loginUrl}...`, 'info');
            logResponse('LOGIN', `Redirecting to: ${loginUrl}`);
            
            // Open in same window - will redirect to GitHub
            window.location.href = loginUrl;
        }

        // Handle callback (if we're on the callback page)
        function handleCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');

            if (error) {
                showStatus('loginStatus', `OAuth Error: ${error}`, 'error');
                logResponse('CALLBACK ERROR', error, true);
                return;
            }

            if (code && state) {
                // We have the callback params - but the API Gateway should have handled this
                // This means we need to call the callback endpoint ourselves if redirected here
                showStatus('loginStatus', 'Received callback, exchanging code...', 'info');
                
                const apiUrl = getApiUrl();
                fetch(`${apiUrl}/auth/github/callback?code=${code}&state=${state}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.error) {
                            showStatus('loginStatus', `Error: ${data.message || data.error}`, 'error');
                            logResponse('CALLBACK', data, true);
                        } else {
                            handleLoginSuccess(data);
                        }
                        // Clear URL params
                        window.history.replaceState({}, '', window.location.pathname);
                    })
                    .catch(err => {
                        showStatus('loginStatus', `Request failed: ${err.message}`, 'error');
                        logResponse('CALLBACK', err.message, true);
                    });
            }
        }

        // Handle successful login
        function handleLoginSuccess(data) {
            currentTokens = {
                accessToken: data.access_token,
                refreshToken: data.refresh_token,
                userId: data.user_id,
                plan: data.plan,
                expiresAtUnix: data.expires_at_unix
            };

            // Update display
            document.getElementById('tokenSection').style.display = 'block';
            document.getElementById('accessTokenDisplay').textContent = data.access_token || '-';
            document.getElementById('refreshTokenDisplay').textContent = data.refresh_token || '-';
            document.getElementById('userIdDisplay').textContent = data.user_id || '-';
            document.getElementById('planDisplay').textContent = data.plan || '-';
            
            if (data.expires_at_unix) {
                const date = new Date(data.expires_at_unix * 1000);
                document.getElementById('expiresDisplay').textContent = date.toLocaleString();
            }

            // Auto-fill test inputs
            document.getElementById('refreshTokenInput').value = data.refresh_token || '';
            document.getElementById('logoutTokenInput').value = data.access_token || '';

            showStatus('loginStatus', '‚úì ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
            logResponse('LOGIN SUCCESS', data);

            // Store in localStorage
            localStorage.setItem('nexus_tokens', JSON.stringify(currentTokens));
        }

        // Test Refresh Token
        async function testRefresh() {
            const refreshToken = document.getElementById('refreshTokenInput').value.trim();
            if (!refreshToken) {
                showStatus('refreshStatus', 'Vui l√≤ng nh·∫≠p refresh token', 'error');
                return;
            }

            const apiUrl = getApiUrl();
            showStatus('refreshStatus', 'ƒêang g·ª≠i request...', 'info');

            try {
                const res = await fetch(`${apiUrl}/auth/refresh`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ refresh_token: refreshToken })
                });

                const data = await res.json();
                
                if (data.error) {
                    showStatus('refreshStatus', `Error: ${data.message || data.error}`, 'error');
                    logResponse('REFRESH', data, true);
                } else {
                    showStatus('refreshStatus', '‚úì Token refreshed successfully!', 'success');
                    logResponse('REFRESH SUCCESS', data);
                    
                    // Update tokens
                    handleLoginSuccess(data);
                }
            } catch (err) {
                showStatus('refreshStatus', `Request failed: ${err.message}`, 'error');
                logResponse('REFRESH', err.message, true);
            }
        }

        // Test Logout
        async function testLogout() {
            const accessToken = document.getElementById('logoutTokenInput').value.trim();
            if (!accessToken) {
                showStatus('logoutStatus', 'Vui l√≤ng nh·∫≠p access token', 'error');
                return;
            }

            const apiUrl = getApiUrl();
            showStatus('logoutStatus', 'ƒêang g·ª≠i request...', 'info');

            try {
                const res = await fetch(`${apiUrl}/auth/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                if (res.status === 204) {
                    showStatus('logoutStatus', '‚úì Token revoked successfully!', 'success');
                    logResponse('LOGOUT SUCCESS', 'Token has been revoked');
                    
                    // Clear stored tokens
                    clearTokens();
                } else {
                    const data = await res.json();
                    showStatus('logoutStatus', `Error: ${data.message || data.error}`, 'error');
                    logResponse('LOGOUT', data, true);
                }
            } catch (err) {
                showStatus('logoutStatus', `Request failed: ${err.message}`, 'error');
                logResponse('LOGOUT', err.message, true);
            }
        }

        // Test List GitHub Repositories
        async function testListRepos() {
            if (!currentTokens.accessToken) {
                showStatus('projectStatus', 'Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc', 'error');
                return;
            }

            const apiUrl = getApiUrl();
            showStatus('projectStatus', 'ƒêang l·∫•y danh s√°ch repos...', 'info');

            try {
                const res = await fetch(`${apiUrl}/api/repos`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentTokens.accessToken}`
                    }
                });

                const data = await res.json();
                
                if (data.error) {
                    showStatus('projectStatus', `Error: ${data.error}`, 'error');
                    logResponse('LIST REPOS', data, true);
                } else {
                    const count = data.repositories ? data.repositories.length : 0;
                    showStatus('projectStatus', `‚úì T√¨m th·∫•y ${count} repositories!`, 'success');
                    logResponse('LIST REPOS SUCCESS', data);
                }
            } catch (err) {
                showStatus('projectStatus', `Request failed: ${err.message}`, 'error');
                logResponse('LIST REPOS', err.message, true);
            }
        }

        // Test List Projects
        async function testListProjects() {
            if (!currentTokens.accessToken) {
                showStatus('projectStatus', 'Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc', 'error');
                return;
            }

            const apiUrl = getApiUrl();
            showStatus('projectStatus', 'ƒêang l·∫•y danh s√°ch projects...', 'info');

            try {
                const res = await fetch(`${apiUrl}/api/projects`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentTokens.accessToken}`
                    }
                });

                const data = await res.json();
                
                if (data.error) {
                    showStatus('projectStatus', `Error: ${data.error}`, 'error');
                    logResponse('LIST PROJECTS', data, true);
                } else {
                    const count = data.projects ? data.projects.length : 0;
                    showStatus('projectStatus', `‚úì T√¨m th·∫•y ${count} projects!`, 'success');
                    logResponse('LIST PROJECTS SUCCESS', data);
                }
            } catch (err) {
                showStatus('projectStatus', `Request failed: ${err.message}`, 'error');
                logResponse('LIST PROJECTS', err.message, true);
            }
        }

        // Test Create Project
        async function testCreateProject() {
            if (!currentTokens.accessToken) {
                showStatus('createProjectStatus', 'Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc', 'error');
                return;
            }

            const name = document.getElementById('projectName').value.trim();
            const repoUrl = document.getElementById('repoUrl').value.trim();
            const preset = document.getElementById('preset').value;

            if (!name || !repoUrl) {
                showStatus('createProjectStatus', 'Vui l√≤ng nh·∫≠p t√™n v√† URL repo', 'error');
                return;
            }

            const apiUrl = getApiUrl();
            showStatus('createProjectStatus', 'ƒêang t·∫°o project...', 'info');

            try {
                const res = await fetch(`${apiUrl}/api/projects`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentTokens.accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        repo_url: repoUrl,
                        preset: preset,
                        branch: 'main'
                    })
                });

                const data = await res.json();
                
                if (data.error) {
                    showStatus('createProjectStatus', `Error: ${data.error}`, 'error');
                    logResponse('CREATE PROJECT', data, true);
                } else {
                    showStatus('createProjectStatus', `‚úì Project "${name}" ƒë√£ ƒë∆∞·ª£c t·∫°o!`, 'success');
                    logResponse('CREATE PROJECT SUCCESS', data);
                    
                    // Clear inputs
                    document.getElementById('projectName').value = '';
                    document.getElementById('repoUrl').value = '';
                }
            } catch (err) {
                showStatus('createProjectStatus', `Request failed: ${err.message}`, 'error');
                logResponse('CREATE PROJECT', err.message, true);
            }
        }

        // Copy tokens to clipboard
        function copyTokens() {
            const text = JSON.stringify(currentTokens, null, 2);
            navigator.clipboard.writeText(text).then(() => {
                alert('ƒê√£ copy tokens v√†o clipboard!');
            });
        }

        // Clear tokens
        function clearTokens() {
            currentTokens = {
                accessToken: null,
                refreshToken: null,
                userId: null,
                plan: null,
                expiresAtUnix: null
            };
            document.getElementById('tokenSection').style.display = 'none';
            document.getElementById('refreshTokenInput').value = '';
            document.getElementById('logoutTokenInput').value = '';
            localStorage.removeItem('nexus_tokens');
        }

        // Clear log
        function clearLog() {
            document.getElementById('responseLog').textContent = 'Log ƒë√£ ƒë∆∞·ª£c x√≥a...';
        }

        // Restore tokens from localStorage
        function restoreTokens() {
            const stored = localStorage.getItem('nexus_tokens');
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    if (data.accessToken) {
                        handleLoginSuccess({
                            access_token: data.accessToken,
                            refresh_token: data.refreshToken,
                            user_id: data.userId,
                            plan: data.plan,
                            expires_at_unix: data.expiresAtUnix
                        });
                        showStatus('loginStatus', '‚úì Restored tokens from localStorage', 'info');
                    }
                } catch (e) {
                    console.error('Failed to restore tokens:', e);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            restoreTokens();
            handleCallback();
        });
    </script>
</body>
</html>

